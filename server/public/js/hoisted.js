const i=(c,e=!1)=>document[`querySelector${e?"All":""}`](c)||null,f=(c,e="document",s="click")=>{let t=e!=null&&typeof e=="object"?e:e=="document"||!e||e==""||e==null?document:i(e,!0);return t==null||t.length==0?!1:(t[0]?t:[t]).forEach(a=>a.addEventListener(s,c))},r=(c="div",e={},s=!1)=>{const t=document.createElement(c);for(let a in e)t.setAttribute(a,e[a]);switch(typeof s){case"boolean":break;case"string":t.innerHTML=s;break;case"object":t.appendChild(s);break}return t},y=c=>(typeof c=="number"?c:new Date().getTime()).toString(36),h=c=>new Promise(e=>setTimeout(e,c)),d=(c=!0)=>{if(console.log("Glass:",c?"true":"false"),c===!1)return i(".__glass").classList.remove("active");let e=i(".__glass");if(!e){let s=r("div",{class:"__glass active"},r("div",{class:"loader"}));i("body").appendChild(s);return}e.classList.add("active")},l=async(c,e="",s=null,t=null)=>{s=s||null,t=t||2e3+c.length*40,e="__rep-"+(e=="info"||e=="i"?"info":e=="warn"||e=="w"?"warn":"alert");const a="__"+y(),o=r("div",{class:`__rep-content ${e}`,id:a},r("span",{class:"__report_i material-symbols-outlined pulse"},"close"));o.innerHTML+=c,f(async p=>{const m=p.currentTarget;m.classList.remove("active"),await h(400),m.remove()},o);let n=i("#__report");n||(n=r("div",{class:"__report",id:"__report"}),i("body").appendChild(n)),n?.appendChild(o),await h(500),i("#"+a).classList.add("active"),await h(t);const u=i("#"+a);u&&(u.classList.remove("active"),await h(400),u.remove())},v=(c,e,s=!0)=>{const t=c.currentTarget;if(t.classList.contains("disabled"))return!1;let a=t.innerHTML.replace("toggle_","")=="on"?"off":"on";return e[a].msg&&!confirm(e[a].msg)?!1:(t.previousElementSibling.innerHTML=e[a].title,s?(t.innerHTML=`toggle_${a}`,t.classList[a=="off"?"add":"remove"]("off"),t.dataset.status=a=="on"?"1":"0",a):(t.remove(),a))};class w{eContainer=null;eBtnSignin=null;eSignin=null;eEmail=null;ePassword=null;eBtnLogin=null;eImage=[];counter=0;imgs=["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg","6.jpg","7.jpg","9.jpg","10.jpg"];Api="";constructor(e){this.Api=e.api,this.eContainer=i("#carousel"),this.eBtnSignin=i("#hom-signin"),this.eSignin=i("#signin")}async init(){f(()=>this.goSignin(),this.eBtnSignin),this.imgs.forEach((e,s)=>{const t=r("img",{src:`/img/${e}`,alt:`Image ${s}`});this.eImage.push(t),this.eContainer?.append(t)}),this.carousel()}async carousel(){await h(6e3),this.counter++,this.counter>=this.imgs.length&&(this.counter=0);const e=this.eImage[this.counter];return e&&(this.eImage.forEach(s=>s.classList.remove("on")),e.classList.add("on")),this.carousel()}goSignin(){const e=r("div",{class:"input"},r("label",{},"E-mail"));this.eEmail=r("input",{type:"email",id:"sgn-email",placeholder:"E-mail"}),e.append(this.eEmail);const s=r("div",{class:"input"},r("label",{},"Password"));this.ePassword=r("input",{type:"password",id:"sgn-password",placeholder:"Password"}),s.append(this.ePassword),this.eBtnLogin=r("button",{id:"sgn-btn-login"},"Login"),f(()=>this.login(),this.eBtnLogin);const t=r("div",{class:"form"});t.append(e,s,this.eBtnLogin),this.eSignin?.append(t),this.eSignin?.classList.add("on"),f(a=>this.closeSignin(a),this.eSignin)}async closeSignin(e,s=!1){(s||e.target==this.eSignin)&&(this.eSignin?.classList.remove("on"),await h(200),this.eSignin&&(this.eSignin.innerHTML=""))}async login(){const e=this.eEmail?.value??"",s=this.ePassword?.value??"";if(e==""||s=="")return l("Please, fill all fields");const t=new FormData;t.append("email",e),t.append("password",s);const a=await fetch(this.Api+"/login",{method:"POST",body:t});if(a.status!=200)return l("Login failed!");const o=await a.json();return o&&o.id&&o.name&&(location.href="/profile"),l("Login failed!")}}class b{eControls=null;eAffiliates=null;data={registered:[],verified:[],approved:[],enabled:[]};user={id:0,name:"",level:"user",action:"",link:"",code:"",aname:"",acode:"",aemail:""};state={on:{title:"Approved",msg:`Do you want to APPROVE this affiliate?
✨ Attention: This will be IRREVERSIBLE! ✨`},off:{title:"Disapproved",msg:`Do you want to DISAPPROVE this affiliate?
✨ Attention: This will be IRREVERSIBLE! ✨`}};Api="";constructor(e){this.Api=e.api,this.eAffiliates=i("#affiliates")}async init(){if(d(),!await this.getAffiliates())return d(!1),!1;this.eControls=i(".control span",!0),this.eControls?.forEach(s=>s.onclick=t=>{const a=v(t,this.state,!1);if(a===!1)return;const o=t.currentTarget;this.setState(o.dataset.id,a=="on")}),i(".aft-plus",!0).forEach(s=>s.onclick=t=>{const a=t.currentTarget.parentElement.parentElement.nextSibling;let o=!a.classList.contains("on");i(".data",!0).forEach(n=>{n.classList.remove("on"),n.previousElementSibling.querySelector(".aft-plus").innerHTML="add"}),a.classList[o?"add":"remove"]("on"),t.currentTarget.innerHTML=o?"remove":"add"}),d(!1)}async getAffiliates(){try{const s=await(await fetch(`${this.Api}/a/affiliates`)).json();if(s){if(s.error==!1&&s.data){const t=s.data;return this.user={id:t.id,name:t.name,level:t.level,action:t.level=="user"?"approved":"enabled",link:t.link,code:t.code,aname:t.aname,acode:t.acode,aemail:t.aemail},this.data.registered=t.registered??[],this.data.verified=t.verified??[],this.data.approved=t.approved??[],this.data.enabled=t.enabled??[],this.mountAffiliates()}if(s.error==!0&&s.msg&&s.link)return this.mountAffiliates(s.msg,s.link)}}catch{}return l("Error to get affiliates!<br>Try again..."),!1}mountAffiliates(e=!1,s=!1){if(e)return this.eAffiliates&&(this.eAffiliates.innerHTML=`<div class="aft-empty"><p>${e}</p><p>Share your COLLABOCRATIC invite link to multiply commercial opportunities and scale your interconnected revenue streams:</p><p><b>${s}</b></p><p>Be Free, Be Freedom eE!</p></div>`),!1;const t=this.user.level;i(".user h1").innerText=this.user.name,this.state.on.title=this.user.action;const a=t=="user"?[].concat(this.data.verified,this.data.registered,this.data.approved,this.data.enabled):[].concat(this.data.approved,this.data.verified,this.data.registered,this.data.enabled);let o="<table><tr><th>Name</th><th>Code</th><th>Status</th><th>Action</th></tr>";return a.map(n=>{let u=t=="user"&&n.status=="verified"||t=="adm"&&n.status=="approved"?`<div>${n.status}</div>
				<span class="material-symbols-outlined off" 
					data-status="0" 
					data-id=${n.uid}>toggle_off</span>`:n.status;o+=`<tr>
            	<td>${n.name}</td>
            	<td>${n.code}</td>
            	<td><div class="control">${u}</div></td>
            	<td><span class="material-symbols-outlined aft-plus">add</span></td>
				<tr class="data">
					<td colspan="4">
						<div class="data-content">
							<div class="top">
								<div><label>Phone:</label>${n.phonecode} ${n.phone}</div>
								<div><label>Email:</label>${n.email}</div>
								<div><label>Company:</label>${n.company}</div>
								<div><label>Country:</label>${n.country}</div>
							</div>				
							<div class="project">${n.projects.split(",").map(p=>`<span>${p}</span>`).join("")}</div>
				${n.password!==!1?`
							<div class="bottom">
								<div><label>Password:</label>${n.password}</div>
								<div><label>Affiliate:</label>${n.aname}</div>
								<div><label>Code:</label>${n.acode}</div>
								<div><label>Email:</label>${n.aemail}</div>
							</div>`:""}
						</div>
					</td>
				</tr>`}),this.eAffiliates&&(this.eAffiliates.innerHTML=o+"</table>"),!0}async setState(e,s){const t=new FormData;t.append("id",e),t.append("set",s?"1":"0"),t.append("state",this.user.action);try{const o=await(await fetch(`${this.Api}/a/setstatus`,{method:"POST",body:t})).json();o&&(o.error&&await this.init(),l(o.msg,"info"))}catch{this.init(),l("I couldn't access the server!")}}}class C{eControls=null;state={on:{title:"Approved",msg:"Do you want to APPROVE this affiliate?"},off:{title:"Disapproved",msg:"Do you want to DISAPPROVE this affiliate?"}};Api="";constructor(e){this.Api=e.api,this.eControls=i(".control span",!0)}init(){this.eControls?.forEach(e=>e.onclick=s=>{const t=v(s,this.state);console.log("ToggleStatus",t)}),i(".aft-plus",!0).forEach(e=>e.onclick=s=>{const t=s.currentTarget.parentElement.parentElement.nextSibling;let a=!t.classList.contains("on");i(".data",!0).forEach(o=>{o.classList.remove("on"),o.previousElementSibling.querySelector(".aft-plus").innerHTML="add"}),t.classList[a?"add":"remove"]("on"),s.currentTarget.innerHTML=a?"remove":"add"})}}let L=class{eAvatar=null;eProjects=null;eFormCountry=null;eSubmit=null;aftName=null;aftId=null;aftCode=null;user=[];state={on:{title:"I want"},off:{title:"No thanks"}};eCountry=null;eCountryResult=null;countries=[];Api="";constructor(e){this.Api=e.api,this.getCountries()}async init(){this.aftName=i("#aft-name").value,this.aftId=i("#aft-id").value,this.aftCode=i("#aft-code").value,this.eAvatar=i("#aft-avatar"),this.eProjects=i(".selector span",!0),this.eFormCountry=i("#form-country"),this.eSubmit=i("#form-submit"),this.eCountry=i("#form-country"),this.eCountryResult=i("#country-result"),this.eProjects?.forEach(e=>f(s=>v(s,this.state),e)),f(()=>this.focusCountry(),this.eCountry,"focus"),f(()=>this.searchCountry(),this.eCountry,"keyup"),f(e=>this.blurCountry(e),this.eCountry,"blur"),f(()=>this.blurCountryRes(),this.eCountryResult,"blur"),f(()=>this.submit(),this.eSubmit)}async submit(){d();const e=this.validate();if(e===!1)return d(!1);if(this.eProjects?.forEach(t=>{t.dataset.status=="1"&&e.projects.push(t.dataset.name)}),e.projects=e.projects.join(","),e.projects.length==0)return d(!1),l("Please select at least one project");const s=new FormData;for(let t in e)s.append(t,e[t]);try{const a=await(await fetch(this.Api+"/a/submit",{method:"POST",body:s})).json();if(a&&a.error===!1)return d(!1),this.pageCode(a);a&&a.msg&&(d(!1),l(a.msg))}catch{}d(!1),l("Please try again later.","info")}validate(){const e=i("#form-name"),s=i("#form-email"),t=i("#form-password"),a=i("#form-cpassword"),o=i("#form-country"),n=i("#form-phone"),u=i("#form-company");return e.value?s.value?t.value?t.value.length<8?(l("Your password is longer than 8 characters"),!1):a.value?a.value!==t.value?(l("Passwords do not match"),!1):!o.value||o.dataset.id==""?(l("Please select your country"),!1):!n.value||n.value.length<6?(l("Please enter your phone number"),!1):u.value?{affiliate:this.aftId,name:e.value,email:s.value,password:t.value,country:o.dataset.id,phone:n.value,company:u.value,projects:[]}:(l("Please enter your company"),!1):(l("Please confirm your password"),!1):(l("Please enter your password"),!1):(l("Please enter your email"),!1):(l("Please enter your name"),!1)}focusCountry(){this.eCountry.value="",this.eCountry.dataset.id="",i(".form-input:has(#form-phone) .divput div").innerHTML="code"}searchCountry(){const e=this.eCountry?.value??"";this.eCountryResult?.classList.add("on"),this.eCountryResult.innerHTML="";let s=4;this.countries.map(t=>{if(s>0){const a=t.name.toLowerCase()??t.name;let o=t.native||"";try{o=t.native.toLowerCase()}catch{}if(a.indexOf(e.toLowerCase())>-1||o.indexOf(e.toLowerCase())>-1){s--;const n=r("li",{"data-id":t.id,"data-phone":t.phonecode,"data-name":t.name},`<span>${t.name}</span><span>${t.native}</span>`);f(u=>this.selectCountry(u.currentTarget.dataset),n),this.eCountryResult?.append(n)}}}),this.eCountryResult?.classList[this.eCountryResult?.innerHTML!=""?"add":"remove"]("on")}async selectCountry(e){this.eCountry.value=e.name,this.eCountry.dataset.id=e.id,i(".form-input:has(#form-phone) .divput div").innerHTML=e.phone,this.eCountryResult?.classList.remove("on"),await h(2e3),this.eCountryResult.innerHTML=""}async blurCountry(e){e.target.dataset.id||(e.target.value=""),i(".form-input:has(#form-phone) .divput div").innerHTML="code",await h(400),this.eCountryResult?.classList.remove("on")}blurCountryRes(){this.eCountryResult?.classList.remove("on")}async getCountries(){try{const s=await(await fetch(this.Api+"/a/countries")).json();if(s&&s.length>0)return this.countries=s,!0}catch{}return!1}pageCode(e){i("main .container").innerHTML="";const s=r("h1",{},"Thank you for registering!"),t=r("p",{},"Your personal COLLABOCRATIC Link is: <b>"+e.link+" </b>"),a=r("p",{},"Share it with responsible entrepreneurs, opinion makers, investors and consumers."),o=r("p",{},"We have sent a verification code to your email. Please check your spam folder as well."),n=r("p",{},"Enter the code below."),u=r("input",{id:"verify-code",placeholder:"999999"}),p=r("button",{},"Verify"),m=r("div",{class:"code"});m.append(u,p);const g=r("div",{class:"join-verify"});g.append(s,t,a,o,n,m),i(".container").append(g),f(()=>this.verify(),p)}async verify(){const e=i("#verify-code").value??"",s=new FormData;s.append("code",e),d();try{const t=await fetch(this.Api+"/a/verify",{method:"POST",body:s});if(t.status!=200)return d(!1),l("Verification failed!<br>Try again.");const a=await t.json();if(a&&a.error==!1&&a.verified==!0)return d(!1),this.pageLogin(e)}catch{}d(!1),l("Invalid code!<br>Try again...")}pageLogin(e){i("main .container").innerHTML="";const s=r("h1",{},"Verified successfully!"),t=r("h2",{},"Sign in now!"),a=r("div",{class:"input"},r("label",{},"E-mail"));a.append(r("input",{type:"email",id:"sgn-email",placeholder:"E-mail"}));const o=r("div",{class:"input"},r("label",{},"Password"));o.append(r("input",{type:"password",id:"sgn-password",placeholder:"Password"}));const n=r("button",{id:"sgn-btn-login"},"Login");f(()=>this.login(e),n);const u=r("div",{class:"form"});u.append(a,o,n);const p=r("div",{class:"join-verify",id:"join-verify"});p.append(s,t,u),i(".container").append(p)}async login(e){const s=i("#sgn-email").value??"",t=i("#sgn-password").value??"";if(s==""||t=="")return l("Please, fill all fields");const a=new FormData;a.append("email",s),a.append("password",t),a.append("verification_key",e),d();try{const o=await fetch(this.Api+"/login",{method:"POST",body:a});if(o.status!=200)return d(!1),l("Login failed!");const n=await o.json();n&&n.id&&n.name&&(location.href="/profile")}catch{}return d(!1),l("Login failed!")}};class A{Api="";constructor(e){this.Api=e.api}async init(){f(()=>this.login(),i(".form button"))}async login(){const e=i("#sgn-email").value??"",s=i("#sgn-password").value??"";if(e==""||s=="")return l("Please, fill all fields");const t=i("#sgn-code").value??"";if(t=="")return location.href="/";if(e==""||s=="")return l("Please, fill all fields");const a=new FormData;a.append("email",e),a.append("password",s),a.append("verification_link",t),d();try{const o=await fetch(this.Api+"/login",{method:"POST",body:a});if(o.status!=200)return d(!1),l("Login failed!");const n=await o.json();n&&n.id&&n.name&&(location.href="/profile")}catch{}return d(!1),l("Login failed!")}}const P=new class{path=["/"];page="home";pages=[];api="";constructor(){this.pages.push({name:"Home",path:"/",view:new w(this)}),this.pages.push({name:"Profile",path:"/profile",view:new b(this)}),this.pages.push({name:"Profile2",path:"/profile2",view:new C(this)}),this.pages.push({name:"Join",path:"/c",view:new L(this)}),this.pages.push({name:"Check",path:"/v",view:new A(this)}),this.router()}router(){this.path=document.location.pathname.replace(/^\/|\/$/g,"").split("/"),this.path[0]==""&&(this.path=["/"]);let e=this.pages.findIndex(s=>s.path=="/"+this.path[0].replace(/^\/|\/$/g,""));e<0&&(e=2),this.page=this.pages[e].name,this.pages[e].view&&this.pages[e].view.init(this.path),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js")}};document.addEventListener("astro:page-load",()=>{P.router()});
